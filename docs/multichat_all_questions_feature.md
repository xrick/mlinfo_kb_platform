# MultiChat 一次性問卷功能說明

## 功能概述

新增了一次性展示所有問題的問卷功能，讓用戶可以一次看到所有7個問題並同時回答，而不需要逐個回答。

## 功能特點

### 1. 觸發方式
用戶可以使用以下關鍵字來觸發一次性問卷模式：
- "一次性"
- "所有問題" 
- "表格"
- "全部問題"
- "問卷"
- "表單"
- "統一回答"
- "batch"

### 2. 界面特點
- **表格式布局**：每一列代表一個問題
- **實時驗證**：顯示已回答問題數量
- **視覺反饋**：已回答的問題會有不同的顏色標示
- **響應式設計**：支援桌面和移動設備

### 3. 向後相容性
- 原有的逐步式多輪對話功能完全保留
- 不包含關鍵字的查詢仍會使用原有的逐步模式
- 所有原有API和功能都保持不變

## 技術實現

### 後端修改
1. **新增方法**：
   - `get_all_questions()`: 獲取所有問題
   - `process_all_questions_response()`: 處理所有問題的回答

2. **新增API端點**：
   - `POST /api/sales/multichat-all`: 處理問卷提交

3. **修改流程**：
   - 在 `chat_stream()` 中新增關鍵字檢測邏輯

### 前端修改
1. **新增渲染函數**：
   - `renderAllQuestionsForm()`: 渲染問卷表格
   - `setupAllQuestionsFormHandlers()`: 設置事件處理器
   - `validateAllQuestionsForm()`: 表單驗證
   - `handleAllQuestionsSubmit()`: 提交處理

2. **新增CSS樣式**：
   - 完整的表格式問卷樣式
   - 響應式設計
   - 狀態視覺反饋

## 測試方法

### 1. 觸發一次性問卷
在聊天界面輸入以下任一句子：
```
請幫我一次性回答所有問題
請顯示筆電問卷表格
我想填寫完整的問卷表單
```

### 2. 測試表單功能
1. 確認所有7個問題都正確顯示
2. 測試單選按鈕功能
3. 驗證表單驗證功能（提交按鈕會在所有問題回答完才啟用）
4. 測試提交功能

### 3. 測試向後相容性
輸入模糊查詢但不包含關鍵字：
```
請推薦筆電
我需要一台筆電
幫我選筆電
```
應該會觸發原有的逐步式對話。

### 4. 測試響應式設計
- 在不同螢幕尺寸下測試界面
- 確認移動設備上的使用體驗

## 問題結構

目前系統支援以下7個問題類別：
1. 處理器(CPU)偏好
2. 顯卡(GPU)需求  
3. 記憶體容量需求
4. 儲存空間需求
5. 螢幕尺寸偏好
6. 重量要求
7. 價格預算

每個問題都有多個選項，包括描述和相應的資料庫篩選條件。

## 部署注意事項

1. **確保依賴完整**：所有原有依賴保持不變
2. **資料庫相容**：新功能使用現有的資料庫結構
3. **緩存清理**：部署後可能需要清理瀏覽器緩存以載入新的CSS和JS
4. **API測試**：確認新的API端點可以正常訪問

## 故障排除

### 常見問題
1. **問卷不顯示**：檢查JavaScript控制台錯誤
2. **提交失敗**：檢查網路連接和API狀態
3. **樣式異常**：確認CSS文件正確載入

### 日誌位置
- 後端日誌：應用程式日誌文件
- 前端日誌：瀏覽器開發者工具控制台

## 未來改進方向

1. **問題順序優化**：根據用戶歷史調整問題順序
2. **智能預填**：基於用戶歷史記錄預填某些選項  
3. **問題分組**：將相關問題分組顯示
4. **進度保存**：允許用戶暫存問卷進度

---

**創建日期**: 2025-07-24  
**版本**: 1.0  
**作者**: Claude Code Assistant