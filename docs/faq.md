# 何時呈現備用表格 (Fallback Table)？

呈現「備用表格」(Fallback Table) 給使用者，**不僅僅是**在 LLM 無法生成合適答案的時候。它是一個更廣泛的策略，用來提升系統的可靠性、透明度和使用者體驗。

在您的 RAG (檢索增強生成) 流程中，備用表格的呈現時機主要基於**檢索(Retrieval)階段的結果**和**生成(Generation)階段的信心度**。

以下是幾個關鍵的觸發時機：

### 1. LLM 生成的答案信賴度低或模棱兩可
這是最常見的情況，符合您的猜想。
*   **情境**: 系統從資料庫（如 `sales_specs.db`）中檢索到了一些相關資料，但這些資料可能不完整、有衝突，或者不足以讓 LLM 有信心地給出一個明確、單一的答案。
*   **例子**:
    *   使用者問：「A產品的最新規格是什麼？」
    *   系統找到了兩份看起來都相關但日期相近的文件，LLM 不確定哪一份才是「最新」的。
    *   **操作**: LLM 可能會生成一個模糊的答案，如：「關於A產品的規格，我找到了幾份可能的資料，但不確定哪一份是您需要的。」然後，系統會緊接著顯示一個包含這兩份資料關鍵欄位的表格，讓使用者自行判斷。

### 2. 檢索到的資料過於龐大或複雜
當檢索結果是大量的結構化數據時，用自然語言總結可能會丟失重要細節，直接呈現表格反而更有效。
*   **情境**: 使用者的查詢本質上更適合用表格來呈現。
*   **例子**:
    *   使用者問：「請列出所有第二季度的銷售紀錄。」
    *   與其讓 LLM 生成一段冗長的文字（「第一筆紀錄是...，第二筆是...」），不如直接顯示一個包含所有銷售紀錄的表格。
    *   **操作**: 系統可以給出一個簡短的引言（「這是您查詢的第二季度銷售紀錄：」），然後呈現完整的表格。

### 3. 查詢意圖是為了「比較」或「分析」
對於需要比較多個項目的查詢，表格是最佳的呈現方式。
*   **情境**: 使用者想要比較不同產品、不同時間段的數據。
*   **例子**:
    *   使用者問：「比較A產品和B產品的性能差異。」
    *   **操作**: 系統直接生成一個並排比較 A 和 B 產品各項規格（如：處理器、內存、價格）的表格，會比 LLM 生成的描述性文字更清晰、直觀。

### 4. LLM 完全無法回答（真正的後備方案）
這是最直接的「Fallback」情況。
*   **情境**: 檢索階段找到了資料，但 LLM 判斷這些資料完全無法回答使用者的問題，或者在生成過程中出錯。
*   **例子**:
    *   使用者問：「哪個產品的客戶滿意度最高？」
    *   系統檢索到了銷售數據，但數據中完全沒有「客戶滿意度」這個欄位。
    *   **操作**: LLM 會誠實地回答：「對不起，我無法在現有資料中找到關於客戶滿意度的資訊。不過，我找到了相關的銷售數據，您可以參考一下。」然後顯示銷售數據的表格，讓使用者知道系統到底找到了什麼。

### 總結

總而言之，備用表格不僅僅是「失敗」時的後備方案，它更是一個**策略性工具**：

*   **提升透明度**: 讓使用者看到答案所依據的原始資料，增加對系統的信任感。
*   **賦予使用者控制權**: 當 AI 的答案不夠完美時，使用者可以根據原始資料自行判斷。
*   **適應不同查詢類型**: 對於某些查詢（如列表、比較），表格本身就是比自然語言更好的答案形式。

在您的 `sales_rag_app` 中，理想的流程應該是：在從資料庫檢索到數據後，系統會有一個判斷邏輯，決定是直接讓 LLM 回答，還是以表格輔助，甚至直接用表格作為主要答案。
